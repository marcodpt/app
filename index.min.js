var F=(t,e,r)=>{e=e||(a=>a),r=r||document;let n=a=>a&&typeof a=="object"&&!(a instanceof Array),c=(a,s)=>n(a)&&n(s)?{...a,...s}:s,u=(a,s)=>typeof a=="string"&&typeof s=="string"?a+s:s,i=a=>{if(a.nodeType!=1)return()=>[e(a.textContent)];let s=a.tagName.toLowerCase(),f=Array.from(a.attributes).map(({nodeName:o,nodeValue:l})=>({key:o,value:a.getAttribute(o)})),h=Array.from((s=="template"?a.content:a).childNodes).map(o=>i(o));return(o,l,m,v)=>f.reduce((A,j)=>A.reduce((p,x)=>{let{scope:y,attributes:E}=x;var{key:b,value:g}=j;return(b.substr(0,1)==":"||b.substr(b.length-1)==":")&&(b=b.substr(0,1)==":"?b.substr(1):b.substr(0,b.length-1),g==""?g=y:y&&typeof y=="object"&&y[g]!=null?g=y[g]:g=null),b=="each"?g instanceof Array&&g.forEach(O=>{p.push({attributes:{...E},scope:c(y,O)})}):b=="with"?g!=null&&p.push({...x,scope:c(y,g)}):b=="if"||b=="not"?(b=="if"&&g||b=="not"&&!g)&&p.push(x):b=="show"||b=="hide"?((b=="hide"&&g||b=="show"&&!g)&&(E.style="display: none;"+(typeof E.style=="string"?E.style:"")),p.push({...x,attributes:E})):b=="case"?l!=null&&l==g&&p.push(x):b=="switch"?p.push({...x,word:g}):b=="bind"?(g&&typeof g=="object"&&Object.keys(g).forEach(O=>{E[O]=u(E[O],g[O])}),p.push({...x,attributes:E})):(E[b]=u(E[b],g),p.push({...x,attributes:E})),p},[]),[{scope:s=="slot"?v:o,attributes:{}}]).reduce((A,{scope:j,attributes:p,word:x})=>{let y=(s=="slot"?m:h).reduce((g,O)=>(O(j,x,m||h,v).forEach(B=>{g.push(B)}),g),[]).filter(g=>g),E=s.indexOf("-")>=0?r.getElementById(s):null;if(p.text!=null&&E==null){for(;y.length;)y.pop();y.push(e(p.text)),p={...p},delete p.text}var b=null;return s=="template"||s=="slot"?b=y:E!=null?b=i(E)(p,null,h,j):b=[t(s,p,y)],b.forEach(g=>{A.push(g)}),A},[])};return(a,s)=>{if(s){let f=a.tagName.toLowerCase(),h=Array.from(a.attributes).reduce((l,{attrName:m,attrValue:v})=>({...l,[m]:v}),{}),o=i(s);return l=>t(f,h,o(l))}else{let f=i(a);return h=>f(h)[0]}}};var S=1,R=3,D={},P=[],k="http://www.w3.org/2000/svg",N=function(t){this.events[t.type](t)},_=t=>t==null?t:t.key,M=(t,e,r,n,c)=>{e==="key"||(e[0]==="o"&&e[1]==="n"?((t.events||(t.events={}))[e=e.slice(2)]=n)?r||t.addEventListener(e,N):t.removeEventListener(e,N):!c&&e!=="list"&&e!=="form"&&e in t?t[e]=n??"":n==null||n===!1?t.removeAttribute(e):t.setAttribute(e,n))},J=(t,e)=>{var r=t.props,n=t.type===R?document.createTextNode(t.tag):(e=e||t.tag==="svg")?document.createElementNS(k,t.tag,{is:r.is}):document.createElement(t.tag,{is:r.is});for(var c in r)M(n,c,null,r[c],e);for(var u=0;u<t.children.length;u++)n.appendChild(J(t.children[u]=L(t.children[u]),e));return t.node=n},C=(t,e,r,n,c)=>{if(r!==n)if(r!=null&&r.type===R&&n.type===R)r.tag!==n.tag&&(e.nodeValue=n.tag);else if(r==null||r.tag!==n.tag)e=t.insertBefore(J(n=L(n),c),e),r!=null&&t.removeChild(r.node);else{var u,i,a,s,f=r.props,h=n.props,o=r.children,l=n.children,m=0,v=0,A=o.length-1,j=l.length-1;c=c||n.tag==="svg";for(var p in{...f,...h})(p==="value"||p==="selected"||p==="checked"?e[p]:f[p])!==h[p]&&M(e,p,f[p],h[p],c);for(;v<=j&&m<=A&&!((a=_(o[m]))==null||a!==_(l[v]));)C(e,o[m].node,o[m++],l[v]=L(l[v++]),c);for(;v<=j&&m<=A&&!((a=_(o[A]))==null||a!==_(l[j]));)C(e,o[A].node,o[A--],l[j]=L(l[j--]),c);if(m>A)for(;v<=j;)e.insertBefore(J(l[v]=L(l[v++]),c),(i=o[m])&&i.node);else if(v>j)for(;m<=A;)e.removeChild(o[m++].node);else{for(var x={},y={},p=m;p<=A;p++)(a=o[p].key)!=null&&(x[a]=o[p]);for(;v<=j;){if(a=_(i=o[m]),s=_(l[v]=L(l[v])),y[a]||s!=null&&s===_(o[m+1])){a==null&&e.removeChild(i.node),m++;continue}s==null||r.type===S?(a==null&&(C(e,i&&i.node,i,l[v],c),v++),m++):(a===s?(C(e,i.node,i,l[v],c),y[s]=!0,m++):(u=x[s])!=null?(C(e,e.insertBefore(u.node,i&&i.node),u,l[v],c),y[s]=!0):C(e,i&&i.node,null,l[v],c),v++)}for(;m<=A;)_(i=o[m++])==null&&e.removeChild(i.node);for(var p in x)y[p]==null&&e.removeChild(x[p].node)}}return n.node=e},L=t=>t!==!0&&t!==!1&&t?t:U(""),Q=t=>t.nodeType===R?U(t.nodeValue,t):$(t.nodeName.toLowerCase(),D,P.map.call(t.childNodes,Q),S,t),$=(t,e,r,n,c)=>({tag:t,props:e,key:e.key,children:r,type:n,node:c}),U=(t,e)=>$(t,D,P,R,e),G=(t,e,r=P)=>$(t,e,Array.isArray(r)?r:[r]),z=(t,e)=>((t=C(t.parentNode,t,t.vdom||Q(t),e)).vdom=e,t);var w=({root:t,template:e,format:r,...n})=>{var c,u=!1;r=typeof r=="function"?r:s=>s,n.init=typeof n.init=="function"?n.init:s=>s,n.done=typeof n.done=="function"?n.done:()=>null;let i=(s,f)=>{if(s=="init"&&!u||s!="init"&&u&&typeof n[s]=="function"){u=!0;let h=s=="init"?n.init(f,i):s=="done"?n.done(c,i):n[s](c,f,i);c=h===void 0?c:h,s=="done"?u=!1:z(t,a(r(c)))}},a=F((s,f,h)=>(Object.keys(f||{}).forEach(o=>{if(o.substr(0,7)=="data-on"&&(o=o.substr(5)),o.substr(0,2)=="on"){let l=f[o]||f["data-"+o];f[o]=m=>{i(l,m)}}}),G(s,f,h)),U)(t,e);return i},d=t=>({...t,Query:t.query.split("&").map(e=>e.split("=")).map(e=>({key:decodeURIComponent(e.shift()),value:decodeURIComponent(e.join("="))})).filter(({key:e})=>e!="").reduce((e,{key:r,value:n})=>(r.substr(r.length-2)=="[]"?(r=r.substr(0,r.length-2),e[r]instanceof Array||(e[r]=[]),e[r].push(n)):e[r]=n,e),{})}),W=({root:t,components:e,routes:r,middleware:n,...c})=>{t=t||document.body.querySelector("main")||document.body,r=r instanceof Array?r:[],n=[d].concat(n).filter(h=>typeof h=="function"),e=e&&typeof e=="object"?e:{};let u=document.createElement("template");r.length&&(Array.from(t.children).forEach(h=>{u.content.appendChild(h.cloneNode(!0))}),e.home={template:u});let i={},a=Object.keys(e).reduce((h,o)=>{let l=e[o];l.root==null&&(l.root=t),l.root==t&&r.length&&l.template==null&&(l.template=u);let m=w(l);return h.push(m),l.root!=t||!r.length?m("init",c[o]):i[o]=m,h},[]);var s=i.home;let f=()=>{let h=window.location.hash,o=h.split("?"),l=o.shift(),m=o.join("?"),v=l.split("/").map(decodeURIComponent),A=r.reduce((j,{route:p,...x})=>{if(p==null){if(!j.weight)return{...x,...j,weight:1}}else{let E=p.split("/");if(E.length==v.length){var y=2;let b=v.reduce((g,O,B)=>(g&&(E[B].substr(0,1)==":"?g[E[B].substr(1)]=O:E[B]!==O?g=null:y++),g),{});if(b&&y>j.weight)return{...x,route:p,Params:b,weight:y}}}return j},{route:null,Params:{},weight:0});if(A){s("done"),s=i[A.component]||i.home;let j=y=>JSON.parse(JSON.stringify(y)),p={url:h,path:l,query:m,route:A.route,Params:A.Params||{}},x={...n.reduce((y,E)=>E(y),j(p)),...p};a.forEach(y=>y("hashchange",j(x))),s("init",{...x,data:c[A.component],root:t,refresh:()=>f()})}};return r.length&&(window.addEventListener("hashchange",f),f()),()=>{r.length&&window.removeEventListener("hashchange",f),a.forEach(h=>h("done"))}};var Y={root:document.getElementById("navbar"),set:(t,e)=>e,init:(t,e)=>{let r=new bootstrap.Offcanvas(document.getElementById("sidebar")),n=()=>e("update"),c=u=>e("update",u.detail);window.addEventListener("hashchange",n),window.addEventListener("navbarchange",c),e("set",{offcanvas:r,hashchange:n,navbarchange:c}),e("update",t)},update:(t,e)=>{if(e&&typeof e=="object"){let{links:u,sidebar:i}=e;t.links=u instanceof Array?u:[],t.sidebar=i instanceof Array?i:[],t.parents=[]}let r=(u,i,a)=>a.reduce((s,f)=>{f.css="",f.open=!1,f.children=f.children||null;let h=(f.href||"").split("?");if(u===h.shift()&&i.indexOf(h.join("?"))==0)s.push([f]);else if(f.children){f.index=t.parents.length,t.parents.push(f);let o=r(u,i,f.children);o.length&&(o.push(f),s.push(o))}return s},[]).reduce((s,f)=>!s.length||(f[0].href||"").length>(s[0].href||"").length?f:s,[]),n=location.hash.split("?");t.parents=[];let c=r(n.shift()||"#",n.join("?"),[].concat(t.links,t.sidebar));return c.forEach(u=>{u.css=" active",u.open=!0}),t.current=c.map(({title:u})=>u).reverse().join(" / "),t},toggle:({parents:t},e)=>{let r=parseInt(e.target.getAttribute("data-index"));t.forEach((n,c)=>{c==r&&(n.open=!n.open)})},hide:({offcanvas:t})=>{t.hide()},format:({current:t,links:e,sidebar:r})=>({current:t,links:e,sidebar:r&&r.length?r:null}),done:({hashchange:t,navbarchange:e})=>{window.removeEventListener("hashchange",t),window.removeEventListener("navbarchange",e)}};var I=(t,e)=>(typeof t!="string"||(t=t.replace(/{([^{}]*)}/g,(r,n)=>e&&(typeof e[n]=="string"||typeof e[n]=="number")?e[n]:"{}"),t.indexOf("{}")>=0&&(t="")),t),q=(t,e)=>{let r=document.head.querySelector(`meta[name='${t}']`),n=(r?r.getAttribute("content"):"")||t;return e&&typeof e=="object"?I(n,e):n},Z=t=>Object.keys(t).reduce((e,r)=>e.concat(t[r]instanceof Array?t[r].map(n=>({key:`${r}[]`,value:n})):{key:r,value:t[r]}),[]).filter(({value:e})=>typeof e=="number"||typeof e=="string").map(({key:e,value:r})=>encodeURIComponent(e)+"="+encodeURIComponent(r)).join("&");var X={template:document.getElementById("view-table"),set:(t,e)=>e,init:({data:t,...e},r)=>{let{schema:n,pages:c,rows:u}=t,i={...e,cssSearch:e.Query._search?"":" disabled",cssFirst:" disabled",cssLast:" disabled"};r("set",i);let a=e.Query._page;if(!a||isNaN(a)){r("goto",{_page:1});return}i.page=parseInt(a),a>1&&(i.cssFirst=""),i.pages=i.page,i.pagination=q("pagination",i),Promise.resolve().then(()=>typeof n=="function"?n(e):null).then(s=>(i.schema=s,typeof c=="function"?c(e):null)).then(s=>{if(s){if(i.pages=s,i.pagination=q("pagination",i),i.page<i.pages)i.cssLast="";else if(i.page>i.pages)throw r("goto",{_page:i.pages}),"redirect"}return typeof u=="function"?u(e):null}).then(s=>{s=s instanceof Array?s:[],i.schema=i.schema||{type:"array",items:{type:"object",properties:s.reduce((o,l)=>(Object.keys(s).forEach(m=>{o[m]==null&&(o[m]={type:typeof l[m],title:m,name:m})}),o),{})}};let f=i.schema.items.properties,h=Object.keys(f);r("set",{...i,title:i.schema.title,description:i.schema.description,links:i.schema.links,columns:h.map(o=>({...f[o],name:o,sort:i.Query._sort==o?"asc":i.Query._sort==`-${o}`?"desc":"none"})),actions:i.schema.items.links,rows:s.map(o=>({fields:h.map(l=>({value:o[l],href:I(f[l].href,o)})),links:(i.schema.items.links||[]).map(({href:l,...m})=>({...m,href:I(l,o)}))}))})}).catch(s=>{if(s!="redirect")throw s})},first:(t,e,r)=>{r("goto",{_page:1})},previous:({page:t},e,r)=>{t>1&&r("goto",{_page:t-1})},next:({page:t,pages:e},r,n)=>{t<e&&n("goto",{_page:t+1})},last:({pages:t},e,r)=>{r("goto",{_page:t})},search:(t,e,r)=>{let n=e.target.value||"";t.Query._search=n,setTimeout(()=>{(e.target.value||"")==n&&r("goto")},500)},sort:({Query:t},e,r)=>{let n=e.target.closest("a").getAttribute("data-sort");r("goto",{_sort:(t._sort==n?"-":"")+n})},goto:({url:t,path:e,Query:r},n)=>{if(location.hash==t){let c=Z({...r,...n||{}});location.replace(e+(c.length?"?"+c:""))}}};var T={template:document.getElementById("view-form"),set:(t,e)=>e,init:({data:t,...e},r)=>{let{schema:n,row:c,submit:u}=t,i={route:e,alert:"danger",schema:null,row:null,fields:null,invalid:" disabled",submit:u};r("set",i),Promise.resolve().then(()=>typeof n=="function"?n(e):null).then(a=>(i.schema=a,a&&(i.title=a.title,i.description=a.description),typeof c=="function"?c(e):null)).then(a=>{a=a&&typeof a=="object"?a:{},i.schema=i.schema||{type:"object",properties:Object.keys(a).forEach(f=>({type:typeof a[f],title:f,name:f}))};let s=i.schema.properties||{};Object.keys(s).forEach(f=>{a[f]==null&&(s[f].default!=null?a[f]=s[f].default:s[f].type=="number"||s[f].type=="integer"?a[f]=0:s[f].type=="string"?a[f]="":s[f].type=="boolean"?a[f]=!1:s[f].type=="object"?a[f]={}:s[f].type=="array"?a[f]=[]:a[f]=null)}),i.fields=Object.keys(s).map(f=>({...s[f],name:f,value:a[f]!=null?a[f]:s[f].default,feedback:"",error:""})),i.links=i.schema.links,r("set",i),r("validate")}).catch(a=>{throw i.result=a.toString(),r("set",i),a})},validate:t=>{let e=(r,n)=>q("error_"+r,{$:n});t.invalid="",t.model=t.fields.reduce((r,n)=>{n.error="";var c=n.value;let{type:u,minLength:i,maxLength:a,pattern:s,minimum:f,maximum:h}=n;return u=="integer"&&!isNaN(c)?c=parseInt(c):u=="number"&&!isNaN(c)&&(c=parseFloat(c)),u=="null"&&c!==null||u=="boolean"&&c!==!1&&c!==!0||u=="object"&&(typeof c!="object"||c==null||c instanceof Array)||u=="array"&&!(c instanceof Array)||u=="string"&&typeof c!="string"||u=="number"&&typeof c!="number"||u=="integer"&&(typeof c!="number"||c%1!==0)?n.error=e("type",u):n.enum instanceof Array&&n.enum.indexOf(c)<0?n.error=e("enum",n.enum):typeof c=="string"?i!=null&&c.length<i?n.error=e("minLength",i):a!=null&&c.length>a?n.error=e("maxLength",a):s!=null&&!new RegExp(s).test(c)&&(n.error=e("pattern",s)):typeof c=="number"&&(f!=null&&c<f?n.error=e("minimum",f):h!=null&&c>h&&(n.error=e("maximum",h))),n.error?(n.feedback=" is-invalid",t.invalid=" disabled"):n.feedback=" is-valid",n.model=c,r[n.name]=c,n.options instanceof Array&&n.options.forEach(o=>{o.value==c?(n.value=o.label,o.css=" active"):o.css=""}),r},{})},submit:(t,e,r)=>{e.preventDefault(),e.stopPropagation(),t.invalid||(t.invalid=" disabled",Promise.resolve().then(()=>t.submit(t.route,t.model)).then(()=>{t.result=t.schema.links[0].description,t.alert="success",r("set",t)}).catch(n=>{throw t.result=n.toString(),t.alert="danger",r("set",t),n}))},change:(t,e,r)=>{let n=e.target.getAttribute("name");t.model[n]=e.target.value,t.fields.forEach(c=>{c.name==n&&(c.value=e.target.value)}),r("validate")}};var H={template:document.getElementById("view-row"),set:(t,e)=>e,init:({data:t,...e},r)=>{let{schema:n,row:c}=t,u={schema:null,row:null,fields:null};r("set",u),Promise.resolve().then(()=>typeof n=="function"?n(e):null).then(i=>(u.schema=i,typeof c=="function"?c(e):null)).then(i=>{i=i&&typeof i=="object"?i:{},u.schema=u.schema||{type:"object",properties:Object.keys(i).forEach(s=>({type:typeof i[s],title:s,name:s}))};let a=u.schema.properties||{};u.fields=Object.keys(a).map(s=>({...a[s],href:I(a[s].href,i),name:s,value:i[s]!=null?i[s]:a[s].default})),u.links=u.schema.links,r("set",u)})}};var be=({components:t,...e})=>W({components:{...t||{},table:X,form:T,row:H,navbar:Y},...e||{}});export{be as default};
