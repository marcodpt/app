var F=(t,e,r)=>{e=e||(a=>a),r=r||document;let n=a=>a&&typeof a=="object"&&!(a instanceof Array),c=(a,i)=>n(a)&&n(i)?{...a,...i}:i,f=(a,i)=>typeof a=="string"&&typeof i=="string"?a+i:i,s=a=>{if(a.nodeType!=1)return()=>[e(a.textContent)];let i=a.tagName.toLowerCase(),o=Array.from(a.attributes).map(({nodeName:u,nodeValue:l})=>({key:u,value:a.getAttribute(u)})),h=Array.from((i=="template"?a.content:a).childNodes).map(u=>s(u));return(u,l,m,v)=>o.reduce((A,j)=>A.reduce((p,x)=>{let{scope:y,attributes:E}=x;var{key:b,value:g}=j;return(b.substr(0,1)==":"||b.substr(b.length-1)==":")&&(b=b.substr(0,1)==":"?b.substr(1):b.substr(0,b.length-1),g==""?g=y:y&&typeof y=="object"&&y[g]!=null?g=y[g]:g=null),b=="each"?g instanceof Array&&g.forEach(O=>{p.push({attributes:{...E},scope:c(y,O)})}):b=="with"?g!=null&&p.push({...x,scope:c(y,g)}):b=="if"||b=="not"?(b=="if"&&g||b=="not"&&!g)&&p.push(x):b=="show"||b=="hide"?((b=="hide"&&g||b=="show"&&!g)&&(E.style="display: none;"+(typeof E.style=="string"?E.style:"")),p.push({...x,attributes:E})):b=="case"?l!=null&&l==g&&p.push(x):b=="switch"?p.push({...x,word:g}):b=="bind"?(g&&typeof g=="object"&&Object.keys(g).forEach(O=>{E[O]=f(E[O],g[O])}),p.push({...x,attributes:E})):(E[b]=f(E[b],g),p.push({...x,attributes:E})),p},[]),[{scope:i=="slot"?v:u,attributes:{}}]).reduce((A,{scope:j,attributes:p,word:x})=>{let y=(i=="slot"?m:h).reduce((g,O)=>(O(j,x,m||h,v).forEach(B=>{g.push(B)}),g),[]).filter(g=>g),E=i.indexOf("-")>=0?r.getElementById(i):null;if(p.text!=null&&E==null){for(;y.length;)y.pop();y.push(e(p.text)),p={...p},delete p.text}var b=null;return i=="template"||i=="slot"?b=y:E!=null?b=s(E)(p,null,h,j):b=[t(i,p,y)],b.forEach(g=>{A.push(g)}),A},[])};return(a,i)=>{if(i){let o=a.tagName.toLowerCase(),h=Array.from(a.attributes).reduce((l,{attrName:m,attrValue:v})=>({...l,[m]:v}),{}),u=s(i);return l=>t(o,h,u(l))}else{let o=s(a);return h=>o(h)[0]}}};var S=1,R=3,D={},P=[],w="http://www.w3.org/2000/svg",N=function(t){this.events[t.type](t)},_=t=>t==null?t:t.key,M=(t,e,r,n,c)=>{e==="key"||(e[0]==="o"&&e[1]==="n"?((t.events||(t.events={}))[e=e.slice(2)]=n)?r||t.addEventListener(e,N):t.removeEventListener(e,N):!c&&e!=="list"&&e!=="form"&&e in t?t[e]=n??"":n==null||n===!1?t.removeAttribute(e):t.setAttribute(e,n))},J=(t,e)=>{var r=t.props,n=t.type===R?document.createTextNode(t.tag):(e=e||t.tag==="svg")?document.createElementNS(w,t.tag,{is:r.is}):document.createElement(t.tag,{is:r.is});for(var c in r)M(n,c,null,r[c],e);for(var f=0;f<t.children.length;f++)n.appendChild(J(t.children[f]=L(t.children[f]),e));return t.node=n},C=(t,e,r,n,c)=>{if(r!==n)if(r!=null&&r.type===R&&n.type===R)r.tag!==n.tag&&(e.nodeValue=n.tag);else if(r==null||r.tag!==n.tag)e=t.insertBefore(J(n=L(n),c),e),r!=null&&t.removeChild(r.node);else{var f,s,a,i,o=r.props,h=n.props,u=r.children,l=n.children,m=0,v=0,A=u.length-1,j=l.length-1;c=c||n.tag==="svg";for(var p in{...o,...h})(p==="value"||p==="selected"||p==="checked"?e[p]:o[p])!==h[p]&&M(e,p,o[p],h[p],c);for(;v<=j&&m<=A&&!((a=_(u[m]))==null||a!==_(l[v]));)C(e,u[m].node,u[m++],l[v]=L(l[v++]),c);for(;v<=j&&m<=A&&!((a=_(u[A]))==null||a!==_(l[j]));)C(e,u[A].node,u[A--],l[j]=L(l[j--]),c);if(m>A)for(;v<=j;)e.insertBefore(J(l[v]=L(l[v++]),c),(s=u[m])&&s.node);else if(v>j)for(;m<=A;)e.removeChild(u[m++].node);else{for(var x={},y={},p=m;p<=A;p++)(a=u[p].key)!=null&&(x[a]=u[p]);for(;v<=j;){if(a=_(s=u[m]),i=_(l[v]=L(l[v])),y[a]||i!=null&&i===_(u[m+1])){a==null&&e.removeChild(s.node),m++;continue}i==null||r.type===S?(a==null&&(C(e,s&&s.node,s,l[v],c),v++),m++):(a===i?(C(e,s.node,s,l[v],c),y[i]=!0,m++):(f=x[i])!=null?(C(e,e.insertBefore(f.node,s&&s.node),f,l[v],c),y[i]=!0):C(e,s&&s.node,null,l[v],c),v++)}for(;m<=A;)_(s=u[m++])==null&&e.removeChild(s.node);for(var p in x)y[p]==null&&e.removeChild(x[p].node)}}return n.node=e},L=t=>t!==!0&&t!==!1&&t?t:U(""),Q=t=>t.nodeType===R?U(t.nodeValue,t):$(t.nodeName.toLowerCase(),D,P.map.call(t.childNodes,Q),S,t),$=(t,e,r,n,c)=>({tag:t,props:e,key:e.key,children:r,type:n,node:c}),U=(t,e)=>$(t,D,P,R,e),G=(t,e,r=P)=>$(t,e,Array.isArray(r)?r:[r]),z=(t,e)=>((t=C(t.parentNode,t,t.vdom||Q(t),e)).vdom=e,t);var d=({root:t,template:e,format:r,...n})=>{var c,f=!1;r=typeof r=="function"?r:i=>i,n.init=typeof n.init=="function"?n.init:i=>i,n.done=typeof n.done=="function"?n.done:()=>null;let s=(i,o)=>{if(i=="init"&&!f||i!="init"&&f&&typeof n[i]=="function"){f=!0;let h=i=="init"?n.init(o,s):i=="done"?n.done(c,s):n[i](c,o,s);c=h===void 0?c:h,i=="done"?f=!1:z(t,a(r(c)))}},a=F((i,o,h)=>(Object.keys(o||{}).forEach(u=>{if(u.substr(0,7)=="data-on"&&(u=u.substr(5)),u.substr(0,2)=="on"){let l=o[u]||o["data-"+u];o[u]=m=>{s(l,m)}}}),G(i,o,h)),U)(t,e);return s},K=t=>({...t,Query:t.query.split("&").map(e=>e.split("=")).map(e=>({key:decodeURIComponent(e.shift()),value:decodeURIComponent(e.join("="))})).filter(({key:e})=>e!="").reduce((e,{key:r,value:n})=>(r.substr(r.length-2)=="[]"?(r=r.substr(0,r.length-2),e[r]instanceof Array||(e[r]=[]),e[r].push(n)):e[r]=n,e),{})}),W=({root:t,components:e,routes:r,middleware:n,...c})=>{t=t||document.body.querySelector("main")||document.body,r=r instanceof Array?r:[],n=[K].concat(n).filter(h=>typeof h=="function"),e=e&&typeof e=="object"?e:{};let f=document.createElement("template");r.length&&(Array.from(t.children).forEach(h=>{f.content.appendChild(h.cloneNode(!0))}),e.home={template:f});let s={},a=Object.keys(e).reduce((h,u)=>{let l=e[u];l.root==null&&(l.root=t),l.root==t&&r.length&&l.template==null&&(l.template=f);let m=d(l);return h.push(m),l.root!=t||!r.length?m("init",c[u]):s[u]=m,h},[]);var i=s.home;let o=()=>{let h=window.location.hash,u=h.split("?"),l=u.shift(),m=u.join("?"),v=l.split("/").map(decodeURIComponent),A=r.reduce((j,{route:p,...x})=>{if(p==null){if(!j.weight)return{...x,...j,weight:1}}else{let E=p.split("/");if(E.length==v.length){var y=2;let b=v.reduce((g,O,B)=>(g&&(E[B].substr(0,1)==":"?g[E[B].substr(1)]=O:E[B]!==O?g=null:y++),g),{});if(b&&y>j.weight)return{...x,route:p,Params:b,weight:y}}}return j},{route:null,Params:{},weight:0});if(A){i("done"),i=s[A.component]||s.home;let j=y=>JSON.parse(JSON.stringify(y)),p={url:h,path:l,query:m,route:A.route,Params:A.Params||{}},x={...n.reduce((y,E)=>E(y),j(p)),...p};a.forEach(y=>y("hashchange",j(x))),i("init",{...x,data:c[A.component],root:t,refresh:()=>o()})}};return r.length&&(window.addEventListener("hashchange",o),o()),()=>{r.length&&window.removeEventListener("hashchange",o),a.forEach(h=>h("done"))}};var Y={root:document.getElementById("navbar"),set:(t,e)=>e,init:(t,e)=>{let r=new bootstrap.Offcanvas(document.getElementById("sidebar")),n=()=>e("update"),c=f=>e("update",f.detail);window.addEventListener("hashchange",n),window.addEventListener("navbarchange",c),e("set",{offcanvas:r,hashchange:n,navbarchange:c}),e("update",t)},update:(t,e)=>{if(e&&typeof e=="object"){let{links:f,sidebar:s}=e;t.links=f instanceof Array?f:[],t.sidebar=s instanceof Array?s:[],t.parents=[]}let r=(f,s,a)=>a.reduce((i,o)=>{o.css="",o.open=!1,o.children=o.children||null;let h=(o.href||"").split("?");if(f===h.shift()&&s.indexOf(h.join("?"))==0)i.push([o]);else if(o.children){o.index=t.parents.length,t.parents.push(o);let u=r(f,s,o.children);u.length&&(u.push(o),i.push(u))}return i},[]).reduce((i,o)=>!i.length||(o[0].href||"").length>(i[0].href||"").length?o:i,[]),n=location.hash.split("?");t.parents=[];let c=r(n.shift()||"#",n.join("?"),[].concat(t.links,t.sidebar));return c.forEach(f=>{f.css=" active",f.open=!0}),t.current=c.map(({title:f})=>f).reverse().join(" / "),t},toggle:({parents:t},e)=>{let r=parseInt(e.target.getAttribute("data-index"));t.forEach((n,c)=>{c==r&&(n.open=!n.open)})},hide:({offcanvas:t})=>{t.hide()},format:({current:t,links:e,sidebar:r})=>({current:t,links:e,sidebar:r&&r.length?r:null}),done:({hashchange:t,navbarchange:e})=>{window.removeEventListener("hashchange",t),window.removeEventListener("navbarchange",e)}};var I=(t,e)=>(typeof t!="string"||(t=t.replace(/{([^{}]*)}/g,(r,n)=>e&&(typeof e[n]=="string"||typeof e[n]=="number")?e[n]:"{}"),t.indexOf("{}")>=0&&(t="")),t),q=(t,e)=>{let r=document.head.querySelector(`meta[name='${t}']`),n=(r?r.getAttribute("content"):"")||t;return e&&typeof e=="object"?I(n,e):n},Z=t=>Object.keys(t).reduce((e,r)=>e.concat(t[r]instanceof Array?t[r].map(n=>({key:`${r}[]`,value:n})):{key:r,value:t[r]}),[]).filter(({value:e})=>typeof e=="number"||typeof e=="string").map(({key:e,value:r})=>encodeURIComponent(e)+"="+encodeURIComponent(r)).join("&");var X={template:document.getElementById("view-table"),set:(t,e)=>e,init:({data:t,...e},r)=>{let{schema:n,pages:c,rows:f}=t,s={...e,cssSearch:e.Query._search?"":" disabled",cssFirst:" disabled",cssLast:" disabled"};r("set",s);let a=e.Query._page;if(!a||isNaN(a)){r("goto",{_page:1});return}s.page=parseInt(a),a>1&&(s.cssFirst=""),s.pages=s.page,s.pagination=q("pagination",s),Promise.resolve().then(()=>typeof n=="function"?n(e):null).then(i=>(s.schema=i,typeof c=="function"?c(e):null)).then(i=>{if(i){if(s.pages=i,s.pagination=q("pagination",s),s.page<s.pages)s.cssLast="";else if(s.page>s.pages)throw r("goto",{_page:s.pages}),"redirect"}return typeof f=="function"?f(e):null}).then(i=>{i=i instanceof Array?i:[],s.schema=s.schema||{type:"array",items:{type:"object",properties:i.reduce((u,l)=>(Object.keys(i).forEach(m=>{u[m]==null&&(u[m]={type:typeof l[m],title:m,name:m})}),u),{})}};let o=s.schema.items.properties,h=Object.keys(o);r("set",{...s,title:s.schema.title,description:s.schema.description,links:s.schema.links,columns:h.map(u=>({...o[u],name:u,sort:s.Query._sort==u?"asc":s.Query._sort==`-${u}`?"desc":"none"})),actions:s.schema.items.links,rows:i.map(u=>({fields:h.map(l=>({value:u[l],href:I(o[l].href,u)})),links:(s.schema.items.links||[]).map(({href:l,...m})=>({...m,href:I(l,u)}))}))})}).catch(i=>{if(i!="redirect")throw i})},first:(t,e,r)=>{r("goto",{_page:1})},previous:({page:t},e,r)=>{t>1&&r("goto",{_page:t-1})},next:({page:t,pages:e},r,n)=>{t<e&&n("goto",{_page:t+1})},last:({pages:t},e,r)=>{r("goto",{_page:t})},search:(t,e,r)=>{let n=e.target.value||"";t.Query._search=n,setTimeout(()=>{(e.target.value||"")==n&&r("goto")},500)},sort:({Query:t},e,r)=>{let n=e.target.closest("a").getAttribute("data-sort");r("goto",{_sort:(t._sort==n?"-":"")+n})},goto:({url:t,path:e,Query:r},n)=>{if(location.hash==t){let c=Z({...r,...n||{}});location.replace(e+(c.length?"?"+c:""))}}};var T={template:document.getElementById("view-form"),set:(t,e)=>e,init:({data:t,...e},r)=>{let{schema:n,row:c,submit:f}=t,s={route:e,alert:"danger",schema:null,row:null,fields:null,invalid:" disabled",submit:f};r("set",s),Promise.resolve().then(()=>typeof n=="function"?n(e):null).then(a=>(s.schema=a,a&&(s.title=a.title,s.description=a.description),typeof c=="function"?c(e):null)).then(a=>{a=a&&typeof a=="object"?a:{},s.schema=s.schema||{type:"object",properties:Object.keys(a).forEach(o=>({type:typeof a[o],title:o,name:o}))};let i=s.schema.properties||{};Object.keys(i).forEach(o=>{a[o]==null&&(i[o].default!=null?a[o]=i[o].default:i[o].type=="number"||i[o].type=="integer"?a[o]=0:i[o].type=="string"?a[o]="":i[o].type=="boolean"?a[o]=!1:i[o].type=="object"?a[o]={}:i[o].type=="array"?a[o]=[]:a[o]=null)}),s.fields=Object.keys(i).map(o=>({...i[o],name:o,value:a[o]!=null?a[o]:i[o].default,feedback:"",error:""})),s.links=s.schema.links,r("set",s),r("validate")}).catch(a=>{throw s.result=a.toString(),r("set",s),a})},validate:t=>{let e=(r,n)=>q("error_"+r,{$:n});t.invalid="",t.model=t.fields.reduce((r,n)=>{n.error="";var c=n.value;let{type:f,minLength:s,maxLength:a,pattern:i,minimum:o,maximum:h}=n;return f=="integer"&&!isNaN(c)?c=parseInt(c):f=="number"&&!isNaN(c)&&(c=parseFloat(c)),f=="null"&&c!==null||f=="boolean"&&c!==!1&&c!==!0||f=="object"&&(typeof c!="object"||c==null||c instanceof Array)||f=="array"&&!(c instanceof Array)||f=="string"&&typeof c!="string"||f=="number"&&typeof c!="number"||f=="integer"&&(typeof c!="number"||c%1!==0)?n.error=e("type",f):n.enum instanceof Array&&n.enum.indexOf(c)<0?n.error=e("enum",n.enum):typeof c=="string"?s!=null&&c.length<s?n.error=e("minLength",s):a!=null&&c.length>a?n.error=e("maxLength",a):i!=null&&!new RegExp(i).test(c)&&(n.error=e("pattern",i)):typeof c=="number"&&(o!=null&&c<o?n.error=e("minimum",o):h!=null&&c>h&&(n.error=e("maximum",h))),n.error?(n.feedback=" is-invalid",t.invalid=" disabled"):n.feedback=" is-valid",n.model=c,r[n.name]=c,n.options instanceof Array&&n.options.forEach(u=>{u.value==c?(n.value=u.label,u.css=" active"):u.css=""}),r},{})},submit:(t,e,r)=>{e.preventDefault(),e.stopPropagation(),t.invalid||(t.invalid=" disabled",Promise.resolve().then(()=>t.submit(t.route,t.model)).then(()=>{t.result=t.schema.links[0].description,t.alert="success",r("set",t)}).catch(n=>{throw t.result=n.toString(),t.alert="danger",r("set",t),n}))},change:(t,e,r)=>{let n=e.target.getAttribute("name");t.model[n]=e.target.value,t.fields.forEach(c=>{c.name==n&&(c.value=e.target.value)}),r("validate")}};var H={template:document.getElementById("view-row"),set:(t,e)=>e,init:({data:t,...e},r)=>{let{schema:n,row:c}=t,f={schema:null,row:null,fields:null};r("set",f),Promise.resolve().then(()=>typeof n=="function"?n(e):null).then(s=>(f.schema=s,typeof c=="function"?c(e):null)).then(s=>{s=s&&typeof s=="object"?s:{},f.schema=f.schema||{type:"object",properties:Object.keys(s).forEach(i=>({type:typeof s[i],title:i,name:i}))};let a=f.schema.properties||{};f.fields=Object.keys(a).map(i=>({...a[i],href:I(a[i].href,s),name:i,value:s[i]!=null?s[i]:a[i].default})),f.links=f.schema.links,r("set",f)})}};var k=({components:t,routes:e,...r})=>W({components:{...t||{},table:X,form:T,row:H,navbar:Y},routes:[{},{route:"#"},{route:"#/"},{route:"#/:name",component:"table"},{route:"#/:name/:id",component:"row"},{route:"#/insert/:name",component:"form"},{route:"#/:service/:name/:id",component:"form"},{route:"#/graph/:name"},{route:"#/chart/:name"},{route:"#/upload"}].concat(e||[]),...r||{}});var Ee=k;export{Ee as default};
